<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.43">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Intentional Prompting: Mastering the Human-AI Development Process – 13&nbsp; Case Studies</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../chapters/14-scaling-complexity.html" rel="next">
<link href="../chapters/12-refactoring-strategies.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapters/10-intentional-prompting-patterns.html">Patterns &amp; Practices</a></li><li class="breadcrumb-item"><a href="../chapters/13-case-studies.html"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Case Studies</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Intentional Prompting: Mastering the Human-AI Development Process</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/michael-borck/python-dev-book" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <div class="dropdown">
      <a href="" title="Download" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label="Download"><i class="bi bi-download"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="../Intentional-Prompting--Mastering-the-Human-AI-Development-Process.pdf">
              <i class="bi bi-file-pdf pe-1"></i>
            Download PDF
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="../Intentional-Prompting--Mastering-the-Human-AI-Development-Process.epub">
              <i class="bi bi-journal pe-1"></i>
            Download ePub
            </a>
          </li>
      </ul>
    </div>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Foundations</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/01-introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/02-ai-revolution.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">The AI Revolution in Programming</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/03-intentional-prompting-principles.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Principles of Intentional Prompting</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Methodology</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/04-six-step-methodology.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">The Six-Step Programming Methodology</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/05-restate-and-identify.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Restate and Identify (Steps 1-2)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/06-work-by-hand.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Work by Hand (Step 3)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/07-pseudocode.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Pseudocode (Step 4)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/08-convert-to-code.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Convert to Code (Step 5)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/09-test-with-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Test with Data (Step 6)</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Patterns &amp; Practices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/10-intentional-prompting-patterns.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Intentional Prompting Patterns</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/11-debugging-with-ai.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Debugging with AI</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/12-refactoring-strategies.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Refactoring Strategies</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/13-case-studies.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Case Studies</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Advanced Topics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/14-scaling-complexity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Scaling to Complex Projects</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/15-teaching-learning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Teaching and Learning</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/16-future-directions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Future Directions</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../acknowledgments.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Acknowledgments</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../appendices/prompt-templates.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Prompt Templates</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../appendices/common-pitfalls.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Common Pitfalls and Solutions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../appendices/ai-tool-comparison.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">AI Tool Comparison</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../appendices/glossary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">D</span>&nbsp; <span class="chapter-title">Glossary</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#case-study-1-building-a-data-analysis-pipeline" id="toc-case-study-1-building-a-data-analysis-pipeline" class="nav-link active" data-scroll-target="#case-study-1-building-a-data-analysis-pipeline"><span class="header-section-number">13.1</span> Case Study 1: Building a Data Analysis Pipeline</a>
  <ul class="collapse">
  <li><a href="#the-problem" id="toc-the-problem" class="nav-link" data-scroll-target="#the-problem"><span class="header-section-number">13.1.1</span> The Problem</a></li>
  <li><a href="#the-intentional-prompting-approach" id="toc-the-intentional-prompting-approach" class="nav-link" data-scroll-target="#the-intentional-prompting-approach"><span class="header-section-number">13.1.2</span> The Intentional Prompting Approach</a></li>
  <li><a href="#before-and-after-example-improving-a-key-function" id="toc-before-and-after-example-improving-a-key-function" class="nav-link" data-scroll-target="#before-and-after-example-improving-a-key-function"><span class="header-section-number">13.1.3</span> Before and After Example: Improving a Key Function</a></li>
  <li><a href="#lessons-learned" id="toc-lessons-learned" class="nav-link" data-scroll-target="#lessons-learned"><span class="header-section-number">13.1.4</span> Lessons Learned</a></li>
  </ul></li>
  <li><a href="#case-study-3-debugging-a-complex-bug" id="toc-case-study-3-debugging-a-complex-bug" class="nav-link" data-scroll-target="#case-study-3-debugging-a-complex-bug"><span class="header-section-number">13.2</span> Case Study 3: Debugging a Complex Bug</a>
  <ul class="collapse">
  <li><a href="#the-problem-1" id="toc-the-problem-1" class="nav-link" data-scroll-target="#the-problem-1"><span class="header-section-number">13.2.1</span> The Problem</a></li>
  <li><a href="#the-intentional-prompting-approach-1" id="toc-the-intentional-prompting-approach-1" class="nav-link" data-scroll-target="#the-intentional-prompting-approach-1"><span class="header-section-number">13.2.2</span> The Intentional Prompting Approach</a></li>
  </ul></li>
  <li><a href="#key-takeaways" id="toc-key-takeaways" class="nav-link" data-scroll-target="#key-takeaways"><span class="header-section-number">13.3</span> Key Takeaways</a></li>
  <li><a href="#moving-forward" id="toc-moving-forward" class="nav-link" data-scroll-target="#moving-forward"><span class="header-section-number">13.4</span> Moving Forward</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/michael-borck/python-dev-book/edit/main/chapters/13-case-studies.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/michael-borck/python-dev-book/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapters/10-intentional-prompting-patterns.html">Patterns &amp; Practices</a></li><li class="breadcrumb-item"><a href="../chapters/13-case-studies.html"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Case Studies</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Case Studies</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this chapter, we’ll explore comprehensive case studies that demonstrate intentional prompting principles applied to real-world programming scenarios. These case studies illustrate how the six-step methodology and intentional prompting techniques come together to solve complex problems effectively.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../images/before-after-case-study.png" class="img-fluid figure-img"></p>
<figcaption>Before and After Case Study</figcaption>
</figure>
</div>
<section id="case-study-1-building-a-data-analysis-pipeline" class="level2" data-number="13.1">
<h2 data-number="13.1" class="anchored" data-anchor-id="case-study-1-building-a-data-analysis-pipeline"><span class="header-section-number">13.1</span> Case Study 1: Building a Data Analysis Pipeline</h2>
<section id="the-problem" class="level3" data-number="13.1.1">
<h3 data-number="13.1.1" class="anchored" data-anchor-id="the-problem"><span class="header-section-number">13.1.1</span> The Problem</h3>
<p>A research team needs to analyze a large dataset of customer transactions to identify purchasing patterns. They have a CSV file with millions of records containing transaction data including:</p>
<ul>
<li>Transaction ID</li>
<li>Customer ID</li>
<li>Date and time</li>
<li>Product categories</li>
<li>Purchase amount</li>
<li>Payment method</li>
<li>Store location</li>
</ul>
<p>The team needs to: 1. Clean and preprocess the data 2. Identify the most frequently purchased product combinations 3. Analyze how purchasing patterns change over time 4. Visualize the results</p>
</section>
<section id="the-intentional-prompting-approach" class="level3" data-number="13.1.2">
<h3 data-number="13.1.2" class="anchored" data-anchor-id="the-intentional-prompting-approach"><span class="header-section-number">13.1.2</span> The Intentional Prompting Approach</h3>
<section id="step-1-restate-the-problem" class="level4" data-number="13.1.2.1">
<h4 data-number="13.1.2.1" class="anchored" data-anchor-id="step-1-restate-the-problem"><span class="header-section-number">13.1.2.1</span> Step 1: Restate the Problem</h4>
<p><strong>Human prompt:</strong></p>
<pre><code>I need to build a data analysis pipeline to process customer transaction data. Let me restate the problem:

We have a large CSV file (millions of rows) with transaction data including transaction ID, customer ID, date/time, product categories, purchase amount, payment method, and store location.

We need to:
1. Clean the data (handle missing values, standardize formats)
2. Find frequently purchased product combinations
3. Analyze how purchasing patterns change over time
4. Create visualizations of the results

Is this understanding correct, and are there any important aspects I've missed?</code></pre>
<p><strong>AI response:</strong> &gt; Your understanding is correct! Your restatement captures the main requirements of building a data analysis pipeline for transaction data. Here are a few additional considerations that might be important: &gt; &gt; 1. <strong>Data volume handling</strong>: With millions of rows, you’ll need efficient processing techniques that can handle large datasets. This might involve streaming processing, chunking the data, or using distributed computing frameworks. &gt; &gt; 2. <strong>Performance considerations</strong>: Some operations like finding product combinations might be computationally expensive. You might need optimization strategies. &gt; &gt; 3. <strong>Data privacy</strong>: Transaction data may contain sensitive information. You might need to anonymize or handle the data according to relevant privacy regulations. &gt; &gt; 4. <strong>Output format</strong>: It’s worth considering what format the final results should be in (static reports, interactive dashboards, raw data for further analysis, etc.). &gt; &gt; 5. <strong>Repeatability</strong>: Will this be a one-time analysis or something that needs to be run regularly? If it’s the latter, the pipeline should be designed for automation and reproducibility. &gt; &gt; 6. <strong>Data quality assessment</strong>: Beyond basic cleaning, you might want to include statistical analysis to identify outliers or anomalies that could skew the results. &gt; &gt; With these considerations in mind, your restatement effectively captures the core of the problem.</p>
</section>
<section id="step-2-identify-input-and-output" class="level4" data-number="13.1.2.2">
<h4 data-number="13.1.2.2" class="anchored" data-anchor-id="step-2-identify-input-and-output"><span class="header-section-number">13.1.2.2</span> Step 2: Identify Input and Output</h4>
<p><strong>Human prompt:</strong></p>
<pre><code>Let me define the specific inputs and outputs for this pipeline:

INPUTS:
- A CSV file with the following columns:
  * transaction_id (string): Unique identifier for each transaction
  * customer_id (string): Identifier for the customer
  * timestamp (datetime): Date and time of the transaction
  * product_categories (string): Comma-separated list of purchased product categories
  * amount (float): Purchase amount in dollars
  * payment_method (string): Method of payment
  * store_location (string): Location identifier for the store

OUTPUTS:
1. Cleaned dataset (CSV or Parquet)
2. Top 20 most frequently purchased product combinations (CSV)
3. Monthly purchasing trends by product category (CSV)
4. Visualizations:
   * Bar chart of top product combinations
   * Line chart showing purchasing trends over time
   * Heatmap of purchase patterns by day of week and hour

Do these specifications adequately cover what's needed for the pipeline?</code></pre>
<p><strong>AI response:</strong> &gt; Your input and output specifications provide a clear framework for the pipeline. They’re comprehensive and specific, which is excellent for guiding the implementation. Here are a few additional points to consider: &gt; &gt; <strong>For inputs:</strong> &gt; &gt; 1. <strong>File format details</strong>: You might want to specify if there are any header rows, quoting patterns, or delimiter specifications for the CSV. &gt; &gt; 2. <strong>Expected data sizes</strong>: Approximate size of the file (GB) and typical row count can help plan for resource requirements. &gt; &gt; 3. <strong>Data quality expectations</strong>: Are there known issues with the data? (e.g., are missing values expected in certain columns, are there known inconsistencies in formatting) &gt; &gt; <strong>For outputs:</strong> &gt; &gt; 1. <strong>Definition of “product combinations”</strong>: Clarify whether this means products purchased together in a single transaction, or products frequently purchased by the same customer across different transactions. &gt; &gt; 2. <strong>Granularity of time analysis</strong>: You specified monthly trends, but you might also want daily or weekly analysis depending on the business needs. &gt; &gt; 3. <strong>Additional metrics</strong>: Consider adding: &gt; - Average basket size (number of items and monetary value) &gt; - Payment method distribution &gt; - Store location performance comparison &gt; &gt; 4. <strong>Output file specifications</strong>: For the CSV outputs, specify whether headers should be included and what the column structure should be. &gt; &gt; 5. <strong>Visualization formats</strong>: Specify the file formats for visualizations (PNG, PDF, interactive HTML, etc.) &gt; &gt; Overall, your specifications are solid and provide a good foundation for the implementation. These additional considerations can help make the requirements even more precise.</p>
</section>
<section id="step-3-work-by-hand" class="level4" data-number="13.1.2.3">
<h4 data-number="13.1.2.3" class="anchored" data-anchor-id="step-3-work-by-hand"><span class="header-section-number">13.1.2.3</span> Step 3: Work by Hand</h4>
<p>In this step, we’d manually process a small sample of the data to understand the analysis process. For brevity, we’ll focus on a simple example of finding product combinations.</p>
<p><strong>Human work:</strong></p>
<p>Sample data (5 transactions):</p>
<pre><code>transaction_id,customer_id,timestamp,product_categories,amount,payment_method,store_location
T1001,C1,2023-01-15 14:30:00,"electronics,accessories",120.50,credit,store1
T1002,C2,2023-01-15 15:45:00,"groceries,dairy,produce",65.75,debit,store2
T1003,C1,2023-01-17 10:15:00,"electronics,videogames",210.99,credit,store1
T1004,C3,2023-01-18 09:30:00,"dairy,produce,meat",95.30,cash,store2
T1005,C2,2023-01-20 16:20:00,"groceries,dairy,bakery",45.60,debit,store2</code></pre>
<p>To find product combinations: 1. Split each transaction’s product_categories field 2. Generate all pair combinations 3. Count frequency of each pair</p>
<p>For T1001: [“electronics”, “accessories”] Pairs: [(“electronics”, “accessories”)]</p>
<p>For T1002: [“groceries”, “dairy”, “produce”] Pairs: [(“groceries”, “dairy”), (“groceries”, “produce”), (“dairy”, “produce”)]</p>
<p>…and so on for all transactions.</p>
<p>Counting frequencies: - (“dairy”, “produce”): 2 - (“groceries”, “dairy”): 2 - All others: 1</p>
<p>Most frequent combinations: (“dairy”, “produce”) and (“groceries”, “dairy”)</p>
<p><strong>Human prompt:</strong></p>
<pre><code>I've worked through a small sample of the data manually to understand the process of finding product combinations. Here's what I did:

[The manual work shown above]

From this manual process, I can see that we need to:
1. Parse the comma-separated product categories
2. Generate all possible pairs from each transaction
3. Count occurrences of each pair across all transactions
4. Sort by frequency to find the most common combinations

This approach works for pairs, but for larger combinations, we might need association rule mining algorithms like Apriori. Does this manual approach seem correct, and are there any important considerations I'm missing?</code></pre>
<p><strong>AI response:</strong> &gt; Your manual approach for finding product combinations is sound! You’ve correctly identified the key steps for analyzing product pairs. Here are some important considerations and extensions: &gt; &gt; <strong>Validations and extensions:</strong> &gt; &gt; 1. <strong>Multiple levels of combinations</strong>: As you noted, beyond pairs, you might want to find triplets or larger combinations. Apriori or FP-Growth algorithms would indeed be appropriate for this. &gt; &gt; 2. <strong>Association metrics</strong>: Beyond just frequency count, consider calculating: &gt; - Support (frequency of the combination relative to total transactions) &gt; - Confidence (likelihood of Y when X is purchased) &gt; - Lift (how much more likely Y is purchased when X is purchased, compared to normal) &gt; &gt; 3. <strong>Performance for large datasets</strong>: The naive approach of generating all combinations can be computationally expensive for transactions with many items. For the full dataset: &gt; - Consider using optimized libraries like MLxtend or efficient implementations of Apriori &gt; - You might need to set a minimum support threshold to filter out rare combinations early &gt; &gt; 4. <strong>Handling duplicates</strong>: If a customer buys multiple items in the same category in one transaction (e.g., two electronics items), your current approach correctly treats “electronics” as appearing once in that transaction. &gt; &gt; 5. <strong>Time-based analysis</strong>: You might want to see if popular combinations change over time (seasonal patterns, etc.) &gt; &gt; Your manual process demonstrates a good understanding of the approach. For implementation at scale, you’ll want to leverage existing libraries rather than building the combination generator from scratch, especially as you move beyond pairs to larger combinations.</p>
</section>
<section id="step-4-write-pseudocode" class="level4" data-number="13.1.2.4">
<h4 data-number="13.1.2.4" class="anchored" data-anchor-id="step-4-write-pseudocode"><span class="header-section-number">13.1.2.4</span> Step 4: Write Pseudocode</h4>
<p>Based on the manual exploration, we can now outline the solution in pseudocode.</p>
<p><strong>Human prompt:</strong></p>
<pre><code>Based on my manual exploration, let me write pseudocode for the data analysis pipeline:
</code></pre>
<p>FUNCTION clean_data(input_file): data = READ_CSV(input_file)</p>
<pre><code># Handle missing values
FILL_MISSING(data.product_categories, "unknown")
FILL_MISSING(data.payment_method, "unknown")
FILL_MISSING(data.store_location, "unknown")
DROP_ROWS_WHERE(data.transaction_id IS NULL OR data.timestamp IS NULL)

# Standardize formats
data.timestamp = CONVERT_TO_DATETIME(data.timestamp)
data.amount = CONVERT_TO_FLOAT(data.amount)

RETURN data</code></pre>
<p>FUNCTION find_product_combinations(data, min_support=0.001): # Initialize counter for product combinations combination_counts = EMPTY_COUNTER() total_transactions = COUNT_ROWS(data)</p>
<pre><code>FOR each row IN data:
    products = SPLIT(row.product_categories, ",")
    product_combinations = GENERATE_COMBINATIONS(products, size=2)
    
    FOR each combination IN product_combinations:
        INCREMENT combination_counts[combination]

# Convert counts to support values
combination_support = EMPTY_DICT()
FOR combination, count IN combination_counts:
    combination_support[combination] = count / total_transactions

# Filter by minimum support
frequent_combinations = FILTER(combination_support &gt;= min_support)

# Sort by support (descending)
frequent_combinations = SORT_DESCENDING(frequent_combinations)

RETURN frequent_combinations</code></pre>
<p>FUNCTION analyze_time_patterns(data): # Add temporal features data[‘month’] = EXTRACT_MONTH(data.timestamp) data[‘year’] = EXTRACT_YEAR(data.timestamp) data[‘day_of_week’] = EXTRACT_WEEKDAY(data.timestamp) data[‘hour’] = EXTRACT_HOUR(data.timestamp)</p>
<pre><code># Group by month and product categories
monthly_trends = GROUP_BY(data, ['year', 'month', 'product_categories'], 
                        AGGREGATE(COUNT(transaction_id), SUM(amount)))

# Group by day of week and hour
hourly_patterns = GROUP_BY(data, ['day_of_week', 'hour', 'product_categories'],
                         AGGREGATE(COUNT(transaction_id)))

RETURN monthly_trends, hourly_patterns</code></pre>
<p>FUNCTION create_visualizations(product_combinations, monthly_trends, hourly_patterns): # Create bar chart of top combinations bar_chart = PLOT_BAR_CHART(TOP_N(product_combinations, 20))</p>
<pre><code># Create line chart of monthly trends
line_chart = PLOT_LINE_CHART(monthly_trends)

# Create heatmap of purchase patterns
heatmap = PLOT_HEATMAP(hourly_patterns)

RETURN bar_chart, line_chart, heatmap</code></pre>
<p>FUNCTION main(input_file, output_dir): # Clean data cleaned_data = clean_data(input_file) SAVE_CSV(cleaned_data, output_dir + “/cleaned_data.csv”)</p>
<pre><code># Find frequent product combinations
product_combinations = find_product_combinations(cleaned_data)
SAVE_CSV(TOP_N(product_combinations, 20), output_dir + "/top_combinations.csv")

# Analyze time patterns
monthly_trends, hourly_patterns = analyze_time_patterns(cleaned_data)
SAVE_CSV(monthly_trends, output_dir + "/monthly_trends.csv")

# Create visualizations
bar_chart, line_chart, heatmap = create_visualizations(
    product_combinations, monthly_trends, hourly_patterns)
SAVE_PNG(bar_chart, output_dir + "/top_combinations.png")
SAVE_PNG(line_chart, output_dir + "/monthly_trends.png")
SAVE_PNG(heatmap, output_dir + "/hourly_patterns.png")</code></pre>
<pre><code>
Does this pseudocode cover all the necessary steps for our data analysis pipeline? Are there any inefficiencies or improvements you would suggest?</code></pre>
<p><strong>AI response:</strong> &gt; Your pseudocode provides a good framework for the data analysis pipeline! It covers the main steps and follows a logical flow. Here are some suggestions for improvements and considerations: &gt; &gt; <strong>Efficiency improvements:</strong> &gt; &gt; 1. <strong>Chunked processing</strong>: For millions of rows, you might want to process the data in chunks to avoid memory issues: &gt; <code>&gt; FUNCTION clean_data(input_file): &gt;     initialize empty dataframe for cleaned_data &gt;     FOR each chunk IN READ_CSV_IN_CHUNKS(input_file, chunk_size=100000): &gt;         # Apply cleaning operations to chunk &gt;         cleaned_chunk = CLEAN_CHUNK(chunk) &gt;         APPEND(cleaned_data, cleaned_chunk) &gt;     RETURN cleaned_data &gt;</code> &gt; &gt; 2. <strong>Optimized product combination generation</strong>: The current approach might be inefficient for transactions with many products: &gt; <code>&gt; # Add a maximum combination size parameter &gt; FUNCTION find_product_combinations(data, min_support=0.001, max_combination_size=2): &gt;     # Use an efficient algorithm like Apriori instead of manual combination generation &gt;     frequent_itemsets = APRIORI_ALGORITHM( &gt;         data.product_categories,  &gt;         min_support=min_support, &gt;         max_length=max_combination_size &gt;     ) &gt;     RETURN frequent_itemsets &gt;</code> &gt; &gt; <strong>Additional considerations:</strong> &gt; &gt; 1. <strong>Data validation</strong>: Add checks for data quality: &gt; <code>&gt; FUNCTION clean_data(input_file): &gt;     # ...existing code... &gt;      &gt;     # Add data validation &gt;     LOG_STATS(COUNT_MISSING_VALUES(data)) &gt;     LOG_STATS(COUNT_UNIQUE_VALUES(data.product_categories)) &gt;     VALIDATE_NUMERIC_RANGE(data.amount, min=0) &gt;      &gt;     # ...rest of function... &gt;</code> &gt; &gt; 2. <strong>Error handling</strong>: Add error handling for robust processing: &gt; <code>&gt; FUNCTION main(input_file, output_dir): &gt;     TRY: &gt;         # ...existing code... &gt;     CATCH FileNotFoundError: &gt;         LOG_ERROR("Input file not found") &gt;     CATCH MemoryError: &gt;         LOG_ERROR("Insufficient memory, try reducing chunk size") &gt;     FINALLY: &gt;         CLEAN_UP_TEMP_FILES() &gt;</code> &gt; &gt; 3. <strong>Parallelization</strong>: For large datasets, consider parallel processing: &gt; <code>&gt; FUNCTION find_product_combinations(data, min_support=0.001): &gt;     # Split data into partitions &gt;     partitions = SPLIT_DATA(data, num_partitions=NUM_CORES) &gt;      &gt;     # Process partitions in parallel &gt;     partial_results = PARALLEL_MAP(PROCESS_PARTITION, partitions) &gt;      &gt;     # Combine results &gt;     combined_results = COMBINE_PARTIAL_RESULTS(partial_results) &gt;     RETURN combined_results &gt;</code> &gt; &gt; 4. <strong>Progress tracking</strong>: For long-running operations, add progress tracking: &gt; <code>&gt; FUNCTION clean_data(input_file): &gt;     total_chunks = ESTIMATE_TOTAL_CHUNKS(input_file, chunk_size) &gt;     FOR i, chunk IN ENUMERATE(READ_CSV_IN_CHUNKS(input_file)): &gt;         LOG_PROGRESS(f"Processing chunk {i}/{total_chunks}") &gt;         # ...process chunk... &gt;</code> &gt; &gt; These improvements would make your pipeline more robust, efficient, and suitable for large-scale data processing. Your current pseudocode is a great starting point, and these suggestions help address some common challenges in real-world data processing.</p>
</section>
<section id="step-5-convert-to-code" class="level4" data-number="13.1.2.5">
<h4 data-number="13.1.2.5" class="anchored" data-anchor-id="step-5-convert-to-code"><span class="header-section-number">13.1.2.5</span> Step 5: Convert to Code</h4>
<p>Now let’s implement the solution in Python, focusing on the product combination analysis.</p>
<p><strong>Human prompt:</strong></p>
<pre><code>Let's convert the pseudocode for finding product combinations into Python code using pandas and mlxtend for the Apriori algorithm:

```python
import pandas as pd
from mlxtend.frequent_patterns import apriori, association_rules
from mlxtend.preprocessing import TransactionEncoder
import numpy as np

def find_product_combinations(data, min_support=0.001, max_len=3):
    """
    Find frequent product combinations using the Apriori algorithm.
    
    Args:
        data (pd.DataFrame): DataFrame containing transaction data
        min_support (float): Minimum support threshold (default: 0.001)
        max_len (int): Maximum combination size (default: 3)
        
    Returns:
        pd.DataFrame: DataFrame with frequent itemsets and their support
    """
    # Extract product categories and split into lists
    transactions = data['product_categories'].str.split(',').tolist()
    
    # Convert transactions to one-hot encoded format
    te = TransactionEncoder()
    te_ary = te.fit_transform(transactions)
    df_encoded = pd.DataFrame(te_ary, columns=te.columns_)
    
    # Apply Apriori algorithm
    frequent_itemsets = apriori(
        df_encoded, 
        min_support=min_support, 
        max_len=max_len,
        use_colnames=True
    )
    
    # Filter itemsets with more than one item
    frequent_itemsets = frequent_itemsets[frequent_itemsets['itemsets'].apply(lambda x: len(x) &gt; 1)]
    
    # Sort by support (descending)
    frequent_itemsets = frequent_itemsets.sort_values('support', ascending=False)
    
    # Format the output
    result = pd.DataFrame({
        'combination': frequent_itemsets['itemsets'].apply(lambda x: ', '.join(list(x))),
        'support': frequent_itemsets['support'],
        'transaction_count': (frequent_itemsets['support'] * len(data)).astype(int)
    })
    
    return result

def clean_data(file_path, chunk_size=100000):
    """
    Clean and preprocess the transaction data.
    
    Args:
        file_path (str): Path to the CSV file
        chunk_size (int): Number of rows to process at once
        
    Returns:
        pd.DataFrame: Cleaned and preprocessed data
    """
    # Initialize an empty list to store chunks
    chunks = []
    
    # Process file in chunks
    for chunk in pd.read_csv(file_path, chunksize=chunk_size):
        # Fill missing values
        chunk['product_categories'] = chunk['product_categories'].fillna('unknown')
        chunk['payment_method'] = chunk['payment_method'].fillna('unknown')
        chunk['store_location'] = chunk['store_location'].fillna('unknown')
        
        # Drop rows with missing essential data
        chunk = chunk.dropna(subset=['transaction_id', 'timestamp'])
        
        # Standardize formats
        chunk['timestamp'] = pd.to_datetime(chunk['timestamp'])
        chunk['amount'] = pd.to_numeric(chunk['amount'], errors='coerce')
        
        # Append the cleaned chunk
        chunks.append(chunk)
    
    # Combine all chunks
    cleaned_data = pd.concat(chunks, ignore_index=True)
    
    return cleaned_data</code></pre>
<p>Is this implementation correct and efficient? Are there any issues or optimizations I should consider?</p>
<pre><code>
**AI response:**
&gt; Your implementation is solid and follows good practices for processing large datasets! Here are some thoughts and potential optimizations:
&gt; 
&gt; **Strengths:**
&gt; 
&gt; 1. Using `chunksize` for reading large CSV files is excellent
&gt; 2. The `mlxtend` library is a good choice for implementing Apriori efficiently
&gt; 3. The code is well-structured with clear documentation
&gt; 4. You've added appropriate data cleaning steps
&gt; 
&gt; **Potential improvements:**
&gt; 
&gt; 1. **Memory optimization for very large datasets:**
&gt; 
&gt; ```python
&gt; def find_product_combinations(data, min_support=0.001, max_len=3):
&gt;     # For extremely large datasets, we might want to sample first
&gt;     if len(data) &gt; 10_000_000:  # Arbitrary threshold
&gt;         data = data.sample(n=10_000_000, random_state=42)
&gt;         print(f"Data sampled to {len(data)} rows due to size")
&gt;     
&gt;     # Rest of your function...
&gt; ```
&gt; 
&gt; 2. **Error handling and logging:**
&gt; 
&gt; ```python
&gt; def clean_data(file_path, chunk_size=100000):
&gt;     chunks = []
&gt;     total_rows = 0
&gt;     invalid_rows = 0
&gt;     
&gt;     try:
&gt;         for i, chunk in enumerate(pd.read_csv(file_path, chunksize=chunk_size)):
&gt;             initial_rows = len(chunk)
&gt;             total_rows += initial_rows
&gt;             
&gt;             # Your cleaning code...
&gt;             
&gt;             invalid_rows += initial_rows - len(chunk)
&gt;             chunks.append(chunk)
&gt;             
&gt;             if i % 10 == 0:
&gt;                 print(f"Processed {i+1} chunks ({total_rows} rows)...")
&gt;         
&gt;         print(f"Cleaning complete. Processed {total_rows} rows, removed {invalid_rows} invalid rows.")
&gt;     except Exception as e:
&gt;         print(f"Error during data cleaning: {str(e)}")
&gt;         raise
&gt; ```
&gt; 
&gt; 3. **Performance optimization for Apriori on sparse data:**
&gt; 
&gt; ```python
&gt; # If your dataset has many distinct products but each transaction has few,
&gt; # use sparse representation for better performance
&gt; from scipy.sparse import csr_matrix
&gt; 
&gt; te_ary = te.fit_transform(transactions)
&gt; sparse_te_ary = csr_matrix(te_ary)
&gt; 
&gt; # Then use the sparse matrix with apriori if mlxtend supports it
&gt; # Otherwise, for very sparse data, consider alternative implementations
&gt; ```
&gt; 
&gt; 4. **Data validation before processing:**
&gt; 
&gt; ```python
&gt; def find_product_combinations(data, min_support=0.001, max_len=3):
&gt;     # Validate input data
&gt;     if 'product_categories' not in data.columns:
&gt;         raise ValueError("DataFrame must contain 'product_categories' column")
&gt;     
&gt;     # Check for empty values post-cleaning
&gt;     empty_cats = data['product_categories'].isin(['', 'unknown']).sum()
&gt;     if empty_cats &gt; 0:
&gt;         print(f"Warning: {empty_cats} rows have empty or unknown product categories")
&gt;     
&gt;     # Rest of your function...
&gt; ```
&gt; 
&gt; 5. **Consider adding time-based analysis:**
&gt; 
&gt; ```python
&gt; def find_seasonal_combinations(data, time_period='month'):
&gt;     """Find how product combinations vary over time."""
&gt;     # Add time period column
&gt;     if time_period == 'month':
&gt;         data['period'] = data['timestamp'].dt.to_period('M')
&gt;     elif time_period == 'quarter':
&gt;         data['period'] = data['timestamp'].dt.to_period('Q')
&gt;     
&gt;     periods = data['period'].unique()
&gt;     results = {}
&gt;     
&gt;     for period in periods:
&gt;         period_data = data[data['period'] == period]
&gt;         period_combos = find_product_combinations(period_data)
&gt;         results[period] = period_combos.head(10)  # Top 10 for each period
&gt;     
&gt;     return results
&gt; ```
&gt; 
&gt; Overall, your implementation is well-designed for the task at hand. These suggestions are refinements that might be helpful in specific scenarios, but your core approach is sound!

#### Step 6: Test with Data

For this step, we would test our implementation with real data, starting with a small sample and progressively increasing to the full dataset.

**Human prompt:**</code></pre>
<p>Let’s test our implementation with a small sample dataset first:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime, timedelta</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create sample data</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">42</span>)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>n_samples <span class="op">=</span> <span class="dv">1000</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate transaction IDs</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>transaction_ids <span class="op">=</span> [<span class="ss">f'T</span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">:04d}</span><span class="ss">'</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n_samples)]</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate customer IDs (100 unique customers)</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>customer_ids <span class="op">=</span> [<span class="ss">f'C</span><span class="sc">{</span>np<span class="sc">.</span>random<span class="sc">.</span>randint(<span class="dv">1</span>, <span class="dv">101</span>)<span class="sc">:03d}</span><span class="ss">'</span> <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(n_samples)]</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate timestamps (last 90 days)</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>base_date <span class="op">=</span> datetime.now() <span class="op">-</span> timedelta(days<span class="op">=</span><span class="dv">90</span>)</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>timestamps <span class="op">=</span> [base_date <span class="op">+</span> timedelta(days<span class="op">=</span>np.random.randint(<span class="dv">0</span>, <span class="dv">90</span>), </span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>                                   hours<span class="op">=</span>np.random.randint(<span class="dv">0</span>, <span class="dv">24</span>),</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>                                   minutes<span class="op">=</span>np.random.randint(<span class="dv">0</span>, <span class="dv">60</span>))</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>             <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(n_samples)]</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Product categories</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>categories <span class="op">=</span> [<span class="st">'electronics'</span>, <span class="st">'accessories'</span>, <span class="st">'clothing'</span>, <span class="st">'shoes'</span>, <span class="st">'books'</span>, </span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>              <span class="st">'groceries'</span>, <span class="st">'dairy'</span>, <span class="st">'produce'</span>, <span class="st">'meat'</span>, <span class="st">'bakery'</span>, <span class="st">'beverages'</span>,</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>              <span class="st">'snacks'</span>, <span class="st">'beauty'</span>, <span class="st">'health'</span>, <span class="st">'kitchen'</span>, <span class="st">'toys'</span>, <span class="st">'sports'</span>,</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>              <span class="st">'automotive'</span>, <span class="st">'garden'</span>, <span class="st">'furniture'</span>]</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate product categories (1-4 categories per transaction)</span></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>product_categories <span class="op">=</span> []</span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(n_samples):</span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>    n_cats <span class="op">=</span> np.random.randint(<span class="dv">1</span>, <span class="dv">5</span>)</span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>    cats <span class="op">=</span> np.random.choice(categories, size<span class="op">=</span>n_cats, replace<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>    product_categories.append(<span class="st">','</span>.join(cats))</span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate amounts</span></span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>amounts <span class="op">=</span> np.random.uniform(<span class="dv">10</span>, <span class="dv">500</span>, n_samples).<span class="bu">round</span>(<span class="dv">2</span>)</span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Payment methods</span></span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a>payment_methods <span class="op">=</span> np.random.choice([<span class="st">'credit'</span>, <span class="st">'debit'</span>, <span class="st">'cash'</span>, <span class="st">'mobile'</span>], </span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a>                                   size<span class="op">=</span>n_samples, </span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a>                                   p<span class="op">=</span>[<span class="fl">0.4</span>, <span class="fl">0.3</span>, <span class="fl">0.2</span>, <span class="fl">0.1</span>])</span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Store locations</span></span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a>store_locations <span class="op">=</span> np.random.choice([<span class="st">'store1'</span>, <span class="st">'store2'</span>, <span class="st">'store3'</span>, <span class="st">'online'</span>], </span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a>                                  size<span class="op">=</span>n_samples,</span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a>                                  p<span class="op">=</span>[<span class="fl">0.3</span>, <span class="fl">0.3</span>, <span class="fl">0.2</span>, <span class="fl">0.2</span>])</span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Create DataFrame</span></span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a>sample_data <span class="op">=</span> pd.DataFrame({</span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a>    <span class="st">'transaction_id'</span>: transaction_ids,</span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a>    <span class="st">'customer_id'</span>: customer_ids,</span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a>    <span class="st">'timestamp'</span>: timestamps,</span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true" tabindex="-1"></a>    <span class="st">'product_categories'</span>: product_categories,</span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true" tabindex="-1"></a>    <span class="st">'amount'</span>: amounts,</span>
<span id="cb14-55"><a href="#cb14-55" aria-hidden="true" tabindex="-1"></a>    <span class="st">'payment_method'</span>: payment_methods,</span>
<span id="cb14-56"><a href="#cb14-56" aria-hidden="true" tabindex="-1"></a>    <span class="st">'store_location'</span>: store_locations</span>
<span id="cb14-57"><a href="#cb14-57" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb14-58"><a href="#cb14-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-59"><a href="#cb14-59" aria-hidden="true" tabindex="-1"></a><span class="co"># Save to CSV</span></span>
<span id="cb14-60"><a href="#cb14-60" aria-hidden="true" tabindex="-1"></a>sample_data.to_csv(<span class="st">'sample_transactions.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb14-61"><a href="#cb14-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-62"><a href="#cb14-62" aria-hidden="true" tabindex="-1"></a><span class="co"># Test our implementation</span></span>
<span id="cb14-63"><a href="#cb14-63" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Find product combinations</span></span>
<span id="cb14-64"><a href="#cb14-64" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> find_product_combinations(sample_data, min_support<span class="op">=</span><span class="fl">0.01</span>, max_len<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb14-65"><a href="#cb14-65" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Found </span><span class="sc">{</span><span class="bu">len</span>(results)<span class="sc">}</span><span class="ss"> frequent product combinations"</span>)</span>
<span id="cb14-66"><a href="#cb14-66" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Top 10 product combinations:"</span>)</span>
<span id="cb14-67"><a href="#cb14-67" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(results.head(<span class="dv">10</span>))</span>
<span id="cb14-68"><a href="#cb14-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-69"><a href="#cb14-69" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Check for issues or unexpected results</span></span>
<span id="cb14-70"><a href="#cb14-70" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Data statistics:"</span>)</span>
<span id="cb14-71"><a href="#cb14-71" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Total transactions: </span><span class="sc">{</span><span class="bu">len</span>(sample_data)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb14-72"><a href="#cb14-72" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Unique product categories: </span><span class="sc">{</span><span class="bu">len</span>(<span class="bu">set</span>(<span class="st">','</span>.join(product_categories).split(<span class="st">','</span>)))<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb14-73"><a href="#cb14-73" aria-hidden="true" tabindex="-1"></a>unique_combos <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb14-74"><a href="#cb14-74" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> cats <span class="kw">in</span> product_categories:</span>
<span id="cb14-75"><a href="#cb14-75" aria-hidden="true" tabindex="-1"></a>    cat_list <span class="op">=</span> cats.split(<span class="st">','</span>)</span>
<span id="cb14-76"><a href="#cb14-76" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(cat_list)):</span>
<span id="cb14-77"><a href="#cb14-77" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(i<span class="op">+</span><span class="dv">1</span>, <span class="bu">len</span>(cat_list)):</span>
<span id="cb14-78"><a href="#cb14-78" aria-hidden="true" tabindex="-1"></a>            unique_combos.add(<span class="bu">tuple</span>(<span class="bu">sorted</span>([cat_list[i], cat_list[j]])))</span>
<span id="cb14-79"><a href="#cb14-79" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Unique product pairs in data: </span><span class="sc">{</span><span class="bu">len</span>(unique_combos)<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>What issues might we encounter when scaling to the full dataset, and how should we address them?</p>
<pre><code>
**AI response:**
&gt; Your test approach with synthetic data is excellent for validating the implementation! Here are the potential issues you might encounter when scaling to the full dataset and strategies to address them:
&gt; 
&gt; **Scaling Issues and Solutions:**
&gt; 
&gt; 1. **Memory Consumption**
&gt;    - **Issue**: The TransactionEncoder creates a one-hot encoded matrix which can be extremely memory-intensive for datasets with millions of transactions and many unique products.
&gt;    - **Solution**: 
&gt;      - Process in batches based on time periods (e.g., analyze one month at a time)
&gt;      - Use sampling techniques for initial analysis
&gt;      - Implement a more memory-efficient version of Apriori or consider alternatives like FP-Growth
&gt;      - Use sparse matrix representations where possible
&gt; 
&gt; 2. **Computation Time**
&gt;    - **Issue**: Apriori's performance degrades significantly with low support thresholds on large datasets.
&gt;    - **Solution**:
&gt;      - Start with higher minimum support values and gradually decrease
&gt;      - Use parallel processing libraries (e.g., Dask, PySpark)
&gt;      - Implement an incremental approach that processes data in chunks and merges results
&gt;      - Consider using GPU-accelerated implementations for very large datasets
&gt; 
&gt; 3. **Long Tail of Infrequent Items**
&gt;    - **Issue**: With millions of transactions, you might get thousands of combinations with low support.
&gt;    - **Solution**:
&gt;      - Focus on combinations with higher lift or confidence scores
&gt;      - Implement filtering for statistically significant associations
&gt;      - Group similar products into categories for higher-level analysis
&gt; 
&gt; 4. **Data Quality at Scale**
&gt;    - **Issue**: Large datasets often have more varied quality issues that become apparent only at scale.
&gt;    - **Solution**:
&gt;      - Implement more robust data cleaning steps
&gt;      - Add comprehensive logging of anomalies
&gt;      - Create data quality dashboards to monitor issues
&gt; 
&gt; 5. **Time-Based Changes**
&gt;    - **Issue**: Product associations may change over time, and analyzing everything together might obscure patterns.
&gt;    - **Solution**:
&gt;      - Implement time-window analysis
&gt;      - Compare associations across different time periods
&gt;      - Look for emerging or declining associations
&gt; 
&gt; **Implementation Improvements for Scale:**
&gt; 
&gt; ```python
&gt; # For very large datasets, consider this approach:
&gt; 
&gt; def analyze_large_dataset(file_path, output_dir):
&gt;     # 1. First pass: Get data statistics and sample
&gt;     print("First pass: Collecting statistics...")
&gt;     stats = collect_data_stats(file_path)
&gt;     
&gt;     # 2. Determine optimal processing approach based on stats
&gt;     if stats['total_rows'] &gt; 10_000_000:
&gt;         print("Very large dataset detected. Using distributed processing...")
&gt;         # Initialize Dask or Spark
&gt;         import dask.dataframe as dd
&gt;         ddf = dd.read_csv(file_path)
&gt;         # Process with distributed framework
&gt;     else:
&gt;         print("Processing with pandas...")
&gt;         # Process with your current approach
&gt;     
&gt;     # 3. Use progressive sampling for quick insights
&gt;     sample_sizes = [10000, 100000, 1000000]
&gt;     for size in sample_sizes:
&gt;         if size &gt; stats['total_rows']: 
&gt;             continue
&gt;         print(f"Analyzing sample of {size} transactions...")
&gt;         sample = get_stratified_sample(file_path, size)
&gt;         # Run analysis on progressively larger samples
&gt;         results = find_product_combinations(sample)
&gt;         save_results(results, f"{output_dir}/sample_{size}_results.csv")
&gt;     
&gt;     # 4. Full analysis with optimized parameters
&gt;     print("Running full analysis with optimized parameters...")
&gt;     # Use parameters learned from sample analysis
&gt;     full_results = process_in_time_windows(file_path)
&gt;     
&gt;     return full_results
&gt; ```
&gt; 
&gt; Your test setup is well-designed. When scaling to millions of rows, implementing these strategies will help manage both memory consumption and computation time while still extracting valuable insights from the data.

### Lessons Learned

This case study demonstrates several key intentional prompting principles:

1. **Thorough problem restatement** helped identify additional considerations beyond the basic requirements
2. **Detailed input/output specification** clarified the exact needs of the pipeline
3. **Manual exploration** of a small data sample provided crucial insights into the required algorithms
4. **Pseudocode development** allowed for structural planning before implementation
5. **Implementation with AI assistance** incorporated best practices and optimizations
6. **Testing with synthetic data** verified the approach before scaling to the full dataset

The intentional prompting methodology led to a solution that was:
- Efficient for large-scale data processing
- Robust to data quality issues
- Flexible enough to handle various analysis requirements
- Well-tested before deployment to the full dataset

## Case Study 2: Building a Weather Dashboard

### The Problem

A developer needs to build a weather dashboard application in Python. The application should:

1. Utilize a weather data module to retrieve current and forecast information
2. Process and display weather data in a user-friendly interface
3. Allow users to search for different locations
4. Provide visualizations of weather trends

### The Intentional Prompting Approach

#### Step 1: Restate the Problem

**Human prompt:**</code></pre>
<p>I need to create a weather dashboard in Python that uses a provided module to access weather data and displays it in a user-friendly interface. Can you help me restate this problem more clearly to ensure I understand all requirements?</p>
<pre><code>
**AI response:**
&gt; This problem involves creating a Python application that:
&gt; 1. Utilises an existing weather data module to retrieve weather information
&gt; 2. Processes that data appropriately
&gt; 3. Presents the information in a clear, user-friendly interface
&gt; 4. Allows users to interact with the dashboard to view different weather metrics
&gt;
&gt; The key components you'll need to develop are:
&gt; - Functions to retrieve and process data from the provided module
&gt; - A display system (likely console-based) to show weather information
&gt; - User interaction components to allow navigation and selection
&gt; - Visualisation elements for presenting weather data graphically

**Human follow-up prompt (clarification):**</code></pre>
<p>That’s helpful. Could you help me understand what types of weather data are typically available through weather APIs, and what visualisations might be most useful for users? This will help me plan my dashboard layout.</p>
<pre><code>
#### Step 2: Identify Input and Output Requirements

**Human prompt:**</code></pre>
<p>Based on our discussion, let me identify the specific inputs and outputs for my weather dashboard:</p>
<p>Inputs: - Location information (city name or coordinates) - Type of weather data requested (current, forecast) - Time period for forecast data</p>
<p>Outputs: - Current weather conditions display - Visual representations of temperature, humidity, etc. - Forecast for upcoming days - User navigation menu</p>
<p>Does this cover the essential inputs and outputs? Is there anything important I’m missing?</p>
<pre><code>
**AI response:**
&gt; Your input/output identification is strong! A few additional considerations:
&gt;
&gt; Additional inputs to consider:
&gt; - User preferences for temperature units (Celsius/Fahrenheit)
&gt; - Display preferences (text-only vs. graphical visualisation)
&gt; - Refresh rate for data updates
&gt;
&gt; Additional outputs to consider:
&gt; - Error messages for handling unavailable data or connection issues
&gt; - Status indicators for data freshness
&gt; - Historical data comparisons (if available)
&gt; - Weather alerts or warnings

#### Step 3: Work Problem by Hand

**Human prompt:**</code></pre>
<p>Before we start coding, I want to sketch out the user interaction flow for the dashboard:</p>
<ol type="1">
<li>User starts program</li>
<li>Program displays welcome and prompts for location</li>
<li>User enters location</li>
<li>Program fetches current weather data</li>
<li>Program displays main dashboard with:
<ul>
<li>Current temperature and conditions</li>
<li>Today’s high/low</li>
<li>Humidity and wind</li>
<li>Simple 3-day forecast</li>
</ul></li>
<li>Program shows menu options:
<ul>
<li>View detailed forecast</li>
<li>View temperature graph</li>
<li>Change location</li>
<li>Exit</li>
</ul></li>
<li>User selects option</li>
<li>Program displays selected information</li>
<li>Return to menu (step 6)</li>
</ol>
<p>Does this flow make sense? Would you structure the user experience differently?</p>
<pre><code>
#### Step 4: Write Pseudocode

**Human prompt:**</code></pre>
<p>Now that we have a clear understanding of the problem and user flow, could you help me write pseudocode for this weather dashboard? I want to focus on creating a modular design with separate functions for data retrieval, display, and user interaction.</p>
<pre><code>
**AI response:**
```python
# Main program structure
function main():
    display_welcome()
    location = get_location_from_user()
    units = get_preferred_units()
    
    while True:
        weather_data = fetch_weather_data(location, units)
        display_dashboard(weather_data)
        choice = display_menu()
        
        if choice == "forecast":
            display_detailed_forecast(weather_data)
        else if choice == "graph":
            display_temperature_graph(weather_data)
        else if choice == "location":
            location = get_location_from_user()
        else if choice == "refresh":
            continue  # Will loop back and refresh data
        else if choice == "exit":
            break

# Data functions
function fetch_weather_data(location, units):
    # Use provided weather module to get data
    current_weather = weather_module.get_current(location, units)
    forecast = weather_module.get_forecast(location, units)
    return {current: current_weather, forecast: forecast}

# Display functions
function display_dashboard(weather_data):
    clear_screen()
    display_current_conditions(weather_data["current"])
    display_simple_forecast(weather_data["forecast"])

function display_detailed_forecast(weather_data):
    clear_screen()
    for day in weather_data["forecast"]:
        display_day_forecast(day)
    wait_for_user()

function display_temperature_graph(weather_data):
    clear_screen()
    temperatures = extract_temperatures(weather_data["forecast"])
    dates = extract_dates(weather_data["forecast"])
    create_line_graph(dates, temperatures)
    wait_for_user()

# User interaction functions
function display_menu():
    print menu options
    return get_valid_choice()

function get_location_from_user():
    prompt for location
    validate location
    return location</code></pre>
<p><strong>Follow-up prompt (challenge):</strong></p>
<pre><code>The pseudocode looks good overall. I noticed that error handling isn't explicitly included. Could you expand the pseudocode to include error handling for:

1. Invalid location input
2. Weather service connection failures
3. Handling missing data in the weather response</code></pre>
</section>
<section id="step-5-convert-to-python-code" class="level4" data-number="13.1.2.6">
<h4 data-number="13.1.2.6" class="anchored" data-anchor-id="step-5-convert-to-python-code"><span class="header-section-number">13.1.2.6</span> Step 5: Convert to Python Code</h4>
<p>The developer starts implementing the solution based on the pseudocode, focusing on modularity, error handling, and user experience.</p>
</section>
<section id="step-6-test-with-data" class="level4" data-number="13.1.2.7">
<h4 data-number="13.1.2.7" class="anchored" data-anchor-id="step-6-test-with-data"><span class="header-section-number">13.1.2.7</span> Step 6: Test with Data</h4>
<p><strong>Human prompt:</strong></p>
<pre><code>Now I want to test this code with some sample data. Can you provide a sample data structure that would be returned by:

1. weather_api.get_current()
2. weather_api.get_forecast()

Also, what test cases should I consider to ensure my dashboard handles all possible scenarios correctly?</code></pre>
<p><strong>AI response:</strong> &gt; Here are sample data structures that might be returned by the weather API: &gt; &gt; <code>python &gt; # Sample current weather data &gt; sample_current = { &gt;     'location': 'New York', &gt;     'timestamp': '2023-09-15 14:30', &gt;     'temperature': 22, &gt;     'feels_like': 24, &gt;     'condition': 'Partly Cloudy', &gt;     'humidity': 65, &gt;     'wind_speed': 8, &gt;     'wind_direction': 'NE', &gt;     'pressure': 1012, &gt;     'visibility': 10, &gt;     'uv_index': 5, &gt;     'units': 'metric' &gt; } &gt; &gt; # Sample forecast data (list of days) &gt; sample_forecast = [ &gt;     { &gt;         'date': '2023-09-15', &gt;         'day_of_week': 'Friday', &gt;         'high': 24, &gt;         'low': 18, &gt;         'condition': 'Partly Cloudy', &gt;         'precipitation_chance': 20, &gt;         'humidity': 65, &gt;         'wind_speed': 8, &gt;         'wind_direction': 'NE', &gt;         'units': 'metric' &gt;     }, &gt;     # Additional days would follow... &gt; ] &gt;</code> &gt; &gt; Test cases to consider: &gt; &gt; 1. <strong>Happy path</strong>: &gt; - Valid location with complete weather data &gt; - Multiple days of forecast &gt; &gt; 2. <strong>Data issues</strong>: &gt; - Missing fields in current weather &gt; - Partial forecast data available &gt; - Empty forecast list &gt; &gt; 3. <strong>Connection issues</strong>: &gt; - API timeout &gt; - Service unavailable &gt; &gt; 4. <strong>User input scenarios</strong>: &gt; - Invalid location name &gt; - Empty input &gt; - Special characters in location name</p>
</section>
</section>
<section id="before-and-after-example-improving-a-key-function" class="level3" data-number="13.1.3">
<h3 data-number="13.1.3" class="anchored" data-anchor-id="before-and-after-example-improving-a-key-function"><span class="header-section-number">13.1.3</span> Before and After Example: Improving a Key Function</h3>
<p>One of the critical functions in the application is the data retrieval function. Let’s examine how intentional prompting improved this function:</p>
<section id="before-initial-data-retrieval-function" class="level4" data-number="13.1.3.1">
<h4 data-number="13.1.3.1" class="anchored" data-anchor-id="before-initial-data-retrieval-function"><span class="header-section-number">13.1.3.1</span> Before: Initial Data Retrieval Function</h4>
<div class="sourceCode" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fetch_weather_data(location, units):</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Fetch weather data from API."""</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    current_weather <span class="op">=</span> weather_api.get_current(location, units)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    forecast <span class="op">=</span> weather_api.get_forecast(location, units, days<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {<span class="st">"current"</span>: current_weather, <span class="st">"forecast"</span>: forecast}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="refinement-process-prompt" class="level4" data-number="13.1.3.2">
<h4 data-number="13.1.3.2" class="anchored" data-anchor-id="refinement-process-prompt"><span class="header-section-number">13.1.3.2</span> Refinement Process Prompt</h4>
<pre><code>The fetch_weather_data() function needs improvement. It doesn't handle errors or validate the data. How can I make it more robust to:

1. Handle connection errors
2. Validate returned data structure
3. Handle missing or incomplete data
4. Provide meaningful error messages to the user</code></pre>
</section>
<section id="after-improved-data-retrieval-function" class="level4" data-number="13.1.3.3">
<h4 data-number="13.1.3.3" class="anchored" data-anchor-id="after-improved-data-retrieval-function"><span class="header-section-number">13.1.3.3</span> After: Improved Data Retrieval Function</h4>
<div class="sourceCode" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fetch_weather_data(location, units):</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Fetch weather data from API with comprehensive error handling.</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="co">        location: City name or location</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="co">        units: 'metric' or 'imperial'</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="co">        Dictionary containing current weather and forecast</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a><span class="co">    Raises:</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a><span class="co">        ConnectionError: If unable to connect to weather service</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a><span class="co">        ValueError: If location is invalid or data is incomplete</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Attempt to get current weather</span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>        current_weather <span class="op">=</span> weather_api.get_current(location, units)</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Validate current weather data</span></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>        required_current_fields <span class="op">=</span> [<span class="st">'temperature'</span>, <span class="st">'condition'</span>, <span class="st">'humidity'</span>, <span class="st">'wind_speed'</span>]</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>        missing_fields <span class="op">=</span> [field <span class="cf">for</span> field <span class="kw">in</span> required_current_fields <span class="cf">if</span> field <span class="kw">not</span> <span class="kw">in</span> current_weather]</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> missing_fields:</span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Handle missing fields by providing defaults</span></span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> field <span class="kw">in</span> missing_fields:</span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>                current_weather[field] <span class="op">=</span> <span class="st">"N/A"</span></span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Log the issue but don't fail completely</span></span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"Warning: Some current weather data is unavailable: </span><span class="sc">{</span><span class="st">', '</span><span class="sc">.</span>join(missing_fields)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Attempt to get forecast with retry mechanism</span></span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a>        max_retries <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a>        retry_count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a>        forecast <span class="op">=</span> <span class="va">None</span></span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb25-37"><a href="#cb25-37" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> retry_count <span class="op">&lt;</span> max_retries <span class="kw">and</span> forecast <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb25-38"><a href="#cb25-38" aria-hidden="true" tabindex="-1"></a>            <span class="cf">try</span>:</span>
<span id="cb25-39"><a href="#cb25-39" aria-hidden="true" tabindex="-1"></a>                forecast <span class="op">=</span> weather_api.get_forecast(location, units, days<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb25-40"><a href="#cb25-40" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span></span>
<span id="cb25-41"><a href="#cb25-41" aria-hidden="true" tabindex="-1"></a>            <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb25-42"><a href="#cb25-42" aria-hidden="true" tabindex="-1"></a>                retry_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb25-43"><a href="#cb25-43" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> retry_count <span class="op">&gt;=</span> max_retries:</span>
<span id="cb25-44"><a href="#cb25-44" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="ss">f"Warning: Could not retrieve forecast data. Using current conditions only."</span>)</span>
<span id="cb25-45"><a href="#cb25-45" aria-hidden="true" tabindex="-1"></a>                    forecast <span class="op">=</span> []  <span class="co"># Empty forecast as fallback</span></span>
<span id="cb25-46"><a href="#cb25-46" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb25-47"><a href="#cb25-47" aria-hidden="true" tabindex="-1"></a>                    time.sleep(<span class="dv">1</span>)  <span class="co"># Wait before retrying</span></span>
<span id="cb25-48"><a href="#cb25-48" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb25-49"><a href="#cb25-49" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Ensure forecast is a list (even if empty)</span></span>
<span id="cb25-50"><a href="#cb25-50" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(forecast, <span class="bu">list</span>):</span>
<span id="cb25-51"><a href="#cb25-51" aria-hidden="true" tabindex="-1"></a>            forecast <span class="op">=</span> []</span>
<span id="cb25-52"><a href="#cb25-52" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb25-53"><a href="#cb25-53" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {</span>
<span id="cb25-54"><a href="#cb25-54" aria-hidden="true" tabindex="-1"></a>            <span class="st">"current"</span>: current_weather, </span>
<span id="cb25-55"><a href="#cb25-55" aria-hidden="true" tabindex="-1"></a>            <span class="st">"forecast"</span>: forecast,</span>
<span id="cb25-56"><a href="#cb25-56" aria-hidden="true" tabindex="-1"></a>            <span class="st">"location"</span>: location,</span>
<span id="cb25-57"><a href="#cb25-57" aria-hidden="true" tabindex="-1"></a>            <span class="st">"units"</span>: units,</span>
<span id="cb25-58"><a href="#cb25-58" aria-hidden="true" tabindex="-1"></a>            <span class="st">"timestamp"</span>: time.strftime(<span class="st">"%Y-%m-</span><span class="sc">%d</span><span class="st"> %H:%M"</span>)</span>
<span id="cb25-59"><a href="#cb25-59" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb25-60"><a href="#cb25-60" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-61"><a href="#cb25-61" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">ConnectionError</span>:</span>
<span id="cb25-62"><a href="#cb25-62" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ConnectionError</span>(<span class="st">"Failed to connect to weather service. Please check your internet connection."</span>)</span>
<span id="cb25-63"><a href="#cb25-63" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">ValueError</span> <span class="im">as</span> e:</span>
<span id="cb25-64"><a href="#cb25-64" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f"Invalid location: </span><span class="sc">{</span>location<span class="sc">}</span><span class="ss">. Please check spelling and try again."</span>)</span>
<span id="cb25-65"><a href="#cb25-65" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb25-66"><a href="#cb25-66" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Convert any other exceptions from the API to something we can handle</span></span>
<span id="cb25-67"><a href="#cb25-67" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">Exception</span>(<span class="ss">f"Error fetching weather data: </span><span class="sc">{</span><span class="bu">str</span>(e)<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="lessons-learned" class="level3" data-number="13.1.4">
<h3 data-number="13.1.4" class="anchored" data-anchor-id="lessons-learned"><span class="header-section-number">13.1.4</span> Lessons Learned</h3>
<p>This case study demonstrates several key aspects of intentional prompting:</p>
<ol type="1">
<li><strong>Thorough problem exploration</strong> - The developer took time to understand requirements and data structures before coding</li>
<li><strong>Modular design</strong> - The solution was broken down into focused functions with clear responsibilities</li>
<li><strong>Proactive error handling</strong> - Multiple failure scenarios were identified and handled gracefully</li>
<li><strong>Iterative refinement</strong> - The initial simple implementation was systematically improved based on specific requirements</li>
<li><strong>Test scenario preparation</strong> - Sample data and test cases were identified before testing began</li>
</ol>
<p>The intentional approach resulted in a robust, maintainable application that properly handles edge cases and provides a good user experience, even when dealing with external data sources that may be unreliable.</p>
</section>
</section>
<section id="case-study-3-debugging-a-complex-bug" class="level2" data-number="13.2">
<h2 data-number="13.2" class="anchored" data-anchor-id="case-study-3-debugging-a-complex-bug"><span class="header-section-number">13.2</span> Case Study 3: Debugging a Complex Bug</h2>
<p>For our final case study, we’ll look at a debugging scenario where intentional prompting techniques help solve a challenging issue.</p>
<section id="the-problem-1" class="level3" data-number="13.2.1">
<h3 data-number="13.2.1" class="anchored" data-anchor-id="the-problem-1"><span class="header-section-number">13.2.1</span> The Problem</h3>
<p>A team is experiencing intermittent failures in their e-commerce checkout system. The checkout process occasionally fails with a generic error message, but only for certain users and at seemingly random times.</p>
</section>
<section id="the-intentional-prompting-approach-1" class="level3" data-number="13.2.2">
<h3 data-number="13.2.2" class="anchored" data-anchor-id="the-intentional-prompting-approach-1"><span class="header-section-number">13.2.2</span> The Intentional Prompting Approach</h3>
<section id="step-1-restate-the-problem-1" class="level4" data-number="13.2.2.1">
<h4 data-number="13.2.2.1" class="anchored" data-anchor-id="step-1-restate-the-problem-1"><span class="header-section-number">13.2.2.1</span> Step 1: Restate the Problem</h4>
<p><strong>Human prompt:</strong></p>
<pre><code>We're experiencing intermittent failures in our checkout system. Let me restate the problem:

Users occasionally receive a generic "Unable to complete checkout" error when attempting to purchase items. The issue:
- Only affects approximately 5% of checkout attempts
- Seems more common during peak traffic hours
- Doesn't consistently affect the same users
- Doesn't correlate with specific products or payment methods
- Leaves limited information in our standard logs

Our goal is to identify the root cause and implement a fix to eliminate these checkout failures.

Is this an appropriate restatement of the debugging challenge?</code></pre>
</section>
<section id="step-2-identify-information-needed" class="level4" data-number="13.2.2.2">
<h4 data-number="13.2.2.2" class="anchored" data-anchor-id="step-2-identify-information-needed"><span class="header-section-number">13.2.2.2</span> Step 2: Identify Information Needed</h4>
<p><strong>Human prompt:</strong></p>
<pre><code>To debug this issue effectively, we need to gather specific information:

INPUTS (Information sources):
- Application logs with enhanced logging enabled
- Database transaction logs
- Server performance metrics during failures
- Network traffic patterns
- User session data for failed checkouts
- Payment processor API logs

OUTPUTS (What we need to determine):
- Exact point of failure in the checkout process
- Conditions that trigger the failure
- Root cause of the issue
- Potential fix or mitigation strategy

Are there other information sources or outputs we should consider to effectively debug this intermittent issue?</code></pre>
<p>The debugging case study would continue through a systematic investigation process, demonstrating how intentional prompting techniques help narrow down the cause of complex bugs.</p>
</section>
</section>
</section>
<section id="key-takeaways" class="level2" data-number="13.3">
<h2 data-number="13.3" class="anchored" data-anchor-id="key-takeaways"><span class="header-section-number">13.3</span> Key Takeaways</h2>
<p>From these case studies, we can extract several important lessons about intentional prompting:</p>
<ol type="1">
<li><strong>Structured methodology yields better results</strong>
<ul>
<li>Following all six steps produces more robust solutions than jumping straight to implementation</li>
<li>Each step builds on the previous one, creating a solid foundation</li>
</ul></li>
<li><strong>Problem exploration is time well spent</strong>
<ul>
<li>Restating the problem and identifying inputs/outputs reveals critical requirements</li>
<li>Manual exploration uncovers edge cases that might otherwise be missed</li>
</ul></li>
<li><strong>AI assistance enhances human capability</strong>
<ul>
<li>AI helps identify potential issues and optimizations</li>
<li>The human developer maintains control over the approach and design decisions</li>
</ul></li>
<li><strong>Testing is essential</strong>
<ul>
<li>Starting with small, synthetic datasets verifies the approach before scaling</li>
<li>Comprehensive testing reveals potential issues early</li>
</ul></li>
<li><strong>Real-world complexity requires adaptability</strong>
<ul>
<li>Initial solutions often need refinement as scale and complexity increase</li>
<li>The methodology provides a framework for iterative improvement</li>
</ul></li>
</ol>
</section>
<section id="moving-forward" class="level2" data-number="13.4">
<h2 data-number="13.4" class="anchored" data-anchor-id="moving-forward"><span class="header-section-number">13.4</span> Moving Forward</h2>
<p>In the next chapter, we’ll explore how to scale intentional prompting to complex projects, moving beyond individual functions or modules to entire systems and codebases.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../chapters/12-refactoring-strategies.html" class="pagination-link" aria-label="Refactoring Strategies">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Refactoring Strategies</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../chapters/14-scaling-complexity.html" class="pagination-link" aria-label="Scaling to Complex Projects">
        <span class="nav-page-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Scaling to Complex Projects</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/michael-borck/python-dev-book/edit/main/chapters/13-case-studies.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/michael-borck/python-dev-book/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>